import{_ as ee,u as te,f as ae,r as o,w as le,o as oe,h as i,i as se,b as ne,c as re,j as s,e as l,k as r,a as D,F as ie,l as de,n as q,t as x,s as ue,v as ce}from"./index-78f5fb40.js";const w=f=>(ue("data-v-58d8ef63"),f=f(),ce(),f),pe={class:"grid"},me={class:"col-12"},ve={class:"card p-4 shadow-2 border-round"},fe=w(()=>s("h2",{class:"text-2xl font-bold"},"طلبات البيانات المناخية",-1)),ge={class:"flex gap-2"},he={class:"card shadow-1 surface-0"},be={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center gap-3"},_e={class:"flex gap-2"},ye={class:"p-input-icon-left"},xe=w(()=>s("i",{class:"pi pi-search"},null,-1)),we={class:"flex gap-2"},Ce={class:"font-medium"},Se=w(()=>s("div",{class:"text-center py-4"},[s("i",{class:"pi pi-exclamation-circle text-2xl mb-2"}),s("p",{class:"text-xl"},"لا توجد بيانات")],-1)),De={class:"flex justify-content-center align-items-center py-4"},qe=w(()=>s("div",{class:"flex align-items-center justify-content-center"},[s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"var(--red-500)"}}),s("span",null,"هل أنت متأكد أنك تريد حذف هذا الطلب؟")],-1)),Re={setup(f){const O=te(),g=ae(),h=o(!0),R=o([]),j=o(""),b=o(!1),k=o(null),T=o({}),_=o("");o(null);const C=o(!1),S=o(!1),V=o(1),L=o(0),N=o(10),F=o(0),P=o([]),u=o(null),c=o(null),p=o(""),m=o(""),B=()=>{D.get("/api/Lookup/CountryList").then(a=>{P.value=a.data.data.map(e=>({id:e.value,name:e.text}))}).catch(a=>{console.error("Error fetching governorates:",a),g.add({severity:"error",summary:"Error",detail:"Failed to load governorates",life:3e3})})},G=()=>{T.value={global:{value:null,matchMode:ie.CONTAINS}}},$=()=>{const a={search:_.value||null,"filter by Governorate":u.value?[{id:"GovernorateId",value:u.value.id.toString()}]:null,"filter by Request Status":c.value!==null?[{id:"ServiceRequest.RequestStatus",value:c.value.toString()}]:null,"filter by two Dates":p.value&&m.value?[{id:"CreatedDate",value:p.value,expression:"GreaterThanOrEqual"},{id:"CreatedDate",value:m.value,expression:"LessThanOrEqual"}]:null,"filter by all":[]};return u.value&&a["filter by all"].push({id:"GovernorateId",value:u.value.id.toString()}),c.value!==null&&a["filter by all"].push({id:"ServiceRequest.RequestStatus",value:c.value.toString()}),p.value&&m.value&&a["filter by all"].push({id:"CreatedDate",value:p.value,expression:"GreaterThanOrEqual"},{id:"CreatedDate",value:m.value,expression:"LessThanOrEqual"}),a["filter by all"].length===0&&delete a["filter by all"],Object.keys(a).forEach(e=>{a[e]===null&&delete a[e]}),a},y=()=>{h.value=!0;const a={Index:V.value,Size:N.value,...$()};D.get("/api/ClimateBank/RequestsManagement",{params:a,paramsSerializer:e=>Object.entries(e).map(([n,d])=>d==null?"":typeof d=="object"?`${n}=${encodeURIComponent(JSON.stringify(d))}`:`${n}=${encodeURIComponent(d)}`).join("&")}).then(e=>{h.value=!1,R.value=e.data.data.list,L.value=e.data.data.total,F.value=e.data.data.pagesCount}).catch(e=>{h.value=!1,console.error("Error fetching data:",e),g.add({severity:"error",summary:"Error",detail:"Failed to load requests",life:3e3})})};le([_,u,c,p,m],()=>{V.value=1,y()});const M=()=>{C.value=!0,k.value.exportCSV(),setTimeout(()=>{C.value=!1},1e3)},U=()=>{S.value=!0;const a=document.querySelector(".p-datatable-wrapper").cloneNode(!0);document.body.innerHTML,a.querySelectorAll(".p-button").forEach(d=>d.remove());const n=window.open("","_blank");n.document.write(`
    <html>
      <head>
        <title>Climate Data Requests Report</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1 { color: #333; text-align: center; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th { background-color: #f5f5f5; text-align: left; padding: 8px; border: 1px solid #ddd; }
          td { padding: 8px; border: 1px solid #ddd; }
          .text-center { text-align: center; }
          .text-right { text-align: right; }
          @page { size: auto; margin: 5mm; }
          @media print {
            body { margin: 0; padding: 0; }
            .no-print { display: none !important; }
          }
        </style>
      </head>
      <body>
        <h1>Climate Data Requests Report</h1>
        ${a.innerHTML}
        <div style="text-align: center; margin-top: 20px; font-size: 12px;">
          Generated on ${new Date().toLocaleString()}
        </div>
      </body>
    </html>
  `),n.document.close(),n.focus(),setTimeout(()=>{n.print(),n.close(),S.value=!1},500)};oe(()=>{B(),y(),G()});const z=()=>{D.delete(`/api/ClimateBank/RequestsManagement/${j.value}`).then(()=>{y(),b.value=!1,g.add({severity:"success",summary:"Successful",detail:"Request Deleted",life:3e3})}).catch(a=>{g.add({severity:"error",summary:"Error",detail:"Failed to delete request",life:3e3})})},A=a=>{O.push({name:"request-details",params:{id:a}})},H=a=>{switch(a){case 0:return"info";case 2:return"danger";case 6:return"warning";default:return"success"}};return(a,e)=>{const n=i("Button"),d=i("Toolbar"),W=i("Toast"),J=i("InputText"),I=i("Dropdown"),E=i("Calendar"),v=i("Column"),Q=i("Tag"),K=i("ProgressSpinner"),X=i("DataTable"),Y=i("Dialog"),Z=se("tooltip");return ne(),re("div",pe,[s("div",me,[s("div",ve,[l(d,{class:"mb-4"},{start:r(()=>[fe]),end:r(()=>[s("div",ge,[l(n,{label:"طباعة",icon:"pi pi-print",class:"p-button-help no-print",loading:S.value,onClick:U},null,8,["loading"]),l(n,{label:"تصدير",icon:"pi pi-download",class:"p-button-info no-print",loading:C.value,onClick:M},null,8,["loading"])])]),_:1}),l(W),s("div",he,[l(X,{ref_key:"dt",ref:k,value:R.value,loading:h.value,"data-key":"id",paginator:!0,rows:N.value,filters:T.value,totalRecords:L.value,"paginator-template":"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown","rows-per-page-options":[5,10,20,30],"current-page-report-template":"عرض {first} إلى {last} من {totalRecords} طلب","responsive-layout":"scroll",scrollable:"","scroll-height":"flex",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{header:r(()=>[s("div",be,[s("div",_e,[s("span",ye,[xe,l(J,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"ابحث...",class:"w-full"},null,8,["modelValue"])]),de(l(n,{icon:"pi pi-refresh",class:"p-button-text",onClick:y},null,512),[[Z,"Refresh data",void 0,{top:!0}]])]),s("div",we,[l(I,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),options:P.value,optionLabel:"name",placeholder:"اختر المحافظة",class:"w-15rem"},null,8,["modelValue","options"]),l(I,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),options:[{label:"تحت الاجراء",value:0},{label:"مرفوض",value:2},{label:"بحاجة الى موافقة",value:6},{label:"مكتمل",value:1}],optionLabel:"label",placeholder:"اختر الحالة",class:"w-15rem"},null,8,["modelValue"]),l(E,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value=t),placeholder:"من تاريخ",dateFormat:"yy-mm-dd",class:"w-10rem"},null,8,["modelValue"]),l(E,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),placeholder:"إلى تاريخ",dateFormat:"yy-mm-dd",class:"w-10rem"},null,8,["modelValue"])])])]),empty:r(()=>[Se]),loading:r(()=>[s("div",De,[l(K,{style:{width:"50px",height:"50px"},strokeWidth:"4"})])]),default:r(()=>[l(v,{"selection-mode":"multiple","header-style":"width: 3rem"}),l(v,{field:"createdDate",header:"تاريخ الطلب",sortable:!0},{body:r(t=>[q(x(new Date(t.data.createdDate).toLocaleDateString()),1)]),_:1}),l(v,{field:"fullName",header:"اسم مقدم الطلب",sortable:!0},{body:r(t=>[s("span",Ce,x(t.data.fullName),1)]),_:1}),l(v,{field:"goalOfClimateInfoName",header:"الغرض من البيانات",sortable:!0},{body:r(t=>[q(x(t.data.goalOfClimateInfoName),1)]),_:1}),l(v,{field:"governorateName",header:"المحافظة",sortable:!0},{body:r(t=>[q(x(t.data.governorateName),1)]),_:1}),l(v,{field:"requestStatusName",header:"حالة الطلب",sortable:!0},{body:r(t=>[l(Q,{value:t.data.requestStatusName,severity:H(t.data.requestStatus)},null,8,["value","severity"])]),_:1}),l(v,{header:"الإجراءات"},{body:r(t=>[l(n,{icon:"pi pi-eye",class:"p-button-rounded p-button-info mr-2",onClick:ke=>A(t.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading","rows","filters","totalRecords"])]),l(Y,{visible:b.value,"onUpdate:visible":e[6]||(e[6]=t=>b.value=t),style:{width:"450px"},header:"تأكيد",modal:!0},{footer:r(()=>[l(n,{label:"لا",icon:"pi pi-times",class:"p-button-text",onClick:e[5]||(e[5]=t=>b.value=!1)}),l(n,{label:"نعم",icon:"pi pi-check",class:"p-button-text p-button-danger",onClick:z})]),default:r(()=>[qe]),_:1},8,["visible"])])])])}}},Ve=ee(Re,[["__scopeId","data-v-58d8ef63"]]);export{Ve as default};
